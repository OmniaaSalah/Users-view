<form [formGroup]="speaEmpForm" *ngIf="currentUserscope == 'SPEA'">
  <div class="custom-form custom-validation-form">
    <!-- SelectSchools -->
    <div class="d-flex align-items-center   ">

      <div class="btn btn-primary " role="button" (click)="openSelectSchoolsModel()">
        {{'dashboard.UserRole.Select School'|translate}}
      </div>
      <span class="star">*</span>
    </div>

    <div *ngIf="selectSchoolModelOpened">
      <app-select-schools selectSchoolModelOpened="selectSchoolModelOpened"></app-select-schools>
    </div>

    <div class="row gx-4 gy-5 my-4 form-set ">


      <div class="prim-table mt-4 col-lg-12" *ngIf="MarkedListLength&&!selectSchoolModelOpened">

        <p-table #dt [value]="schoolIsSelectedList" sortMode="single" [scrollable]="true" scrollHeight="350px"
          [virtualScrollItemSize]="true" [virtualRowHeight]="30">

          <ng-template pTemplate="header">

            <tr>
              <th pSortableColumn="name.ar" style="min-width:27rem">
                <p-sortIcon field="name"></p-sortIcon>
                {{'dashboard.schools.schoolName'|translate}}
              </th>
              <th pSortableColumn="state.ar">
                <p-sortIcon field="state"></p-sortIcon>
                {{'shared.state'|translate}}
              </th>
              <th pSortableColumn="curriculum.ar">
                <p-sortIcon field="curriculum"></p-sortIcon>{{'shared.curriculum'|translate}}</th>
              <th class="actions"></th>
            </tr>

          </ng-template>

          <ng-template pTemplate="body" let-school>
            <tr >
              <td style="min-width:27rem">{{school.name|currentLang}}</td>
              <td>{{school.state|currentLang}}</td>
              <td>{{school.curriculum|currentLang}}</td>
              <td class="actions">
                <button >

                  <img ConfirmDialog (onConfirm)="unSelectSchool(school.id)" src="assets/images/shared/rect-xmark.svg" alt="">

                </button>
              </td>
            </tr>
          </ng-template>

        </p-table>
      </div>



      <ng-container *ngIf="!MarkedListLength&&!selectSchoolModelOpened">

        <app-informative-block title="{{'emptyList.Schools not selected yet' |translate}}"
          subTitle="{{'emptyList.Pleaze, Select School' |translate}}"
          src="assets/images/empty-list/empty-list.svg"></app-informative-block>

      </ng-container>

      <div class="alert col-lg-8" *ngIf="MarkedListLength&&!selectSchoolModelOpened">

        <p>{{'dashboard.UserRole.exist'|translate}} {{MarkedListLength}} {{'dashboard.UserRole.school selected for this role'|translate}}</p>

      </div>
    </div>




    <div class="mb-5">
      <label class="label">{{'dashboard.Messages.Enter the message title' | translate}} <span class="star">*</span></label>
      <input maxlength="32" class="form-control py-s" type="text" formControlName="title"
        placeholder="{{'dashboard.Messages.Enter the message title' | translate}}">
      <div class="text-danger"
        *ngIf="this.speaEmpForm.get('title')?.touched && this.speaEmpForm.get('title')?.invalid && this.speaEmpForm.get('title')?.errors">
        <small *ngIf="this.speaEmpForm.get('title')?.errors?.['required']">{{'dashboard.Messages.descriptionMessage' |
          translate}}</small>
        <small *ngIf="this.speaEmpForm.get('title')?.errors?.['maxlength']">{{'dashboard.Messages.maxLengtho' |
          translate}}</small>
      </div>
    </div>

    <div class="mb-5">
      <label class="label">{{'dashboard.Messages.MessageType' | translate}} <span class="star">*</span></label>
      <p-dropdown [options]="messagesTypes" [filter]="true"  [ngClass]="{'ng-invalid ng-dirty':speaEmpForm.get('messageType')?.errors?.['required']&& speaEmpForm.get('messageType')?.touched}"
      filterBy="{{lang=='ar'? 'name.ar' : 'name.en'}}" optionLabel="{{lang=='ar'? 'name.ar' : 'name.en'}}" optionValue="id" formControlName="messageType"
        placeholder="{{'dashboard.Messages.MessageType' | translate}}"></p-dropdown>
      <div class="text-danger"
        *ngIf="this.speaEmpForm.get('messageType')?.touched && this.speaEmpForm.get('messageType')?.invalid && this.speaEmpForm.get('messageType')?.errors">
        <small
          *ngIf="this.speaEmpForm.get('messageType')?.errors?.['required']">{{'dashboard.Messages.descriptionMessage' |
          translate}}</small>
      </div>
    </div>

    <div class="d-flex  my-4 gap-5">
      <div class=" d-flex gap-3  align-items-center">
        <label  for="">{{'dashboard.Messages.Require confirmation of receipt' | translate}}</label>
        <p-inputSwitch (onChange)="isToggleLabel($event)" formControlName="switch1"></p-inputSwitch>

      </div>
      <div class="d-flex gap-3  align-items-center">
        <label  for=""> {{'dashboard.Messages.Possibility to reply' | translate}} <span
            class="star">*</span></label>
        <p-inputSwitch (onChange)="isToggleLabel1($event)" formControlName="switch2"></p-inputSwitch>

      </div>

      <div class="d-flex gap-3  align-items-center">
        <label  for="">{{'dashboard.Messages.senderName' | translate}}</label>
        <p-inputSwitch (onChange)="isToggleLabel2($event)"  formControlName="switch3"></p-inputSwitch>

      </div>
    </div>


    <div class="mb-5">
      <label class="label" for="">{{'dashboard.Messages.Enter the text of the message' | translate}} <span
          class="star">*</span></label>
      <textarea maxlength="512" class="form-s form-control" formControlName="description"
        placeholder="{{'dashboard.Messages.Enter the text of the message' | translate}}" rows="5"
        pInputTextarea></textarea>
      <div class="text-danger"
        *ngIf="this.speaEmpForm.get('description')?.touched && this.speaEmpForm.get('description')?.invalid && this.speaEmpForm.get('description')?.errors">
        <small
          *ngIf="this.speaEmpForm.get('description')?.errors?.['required']">{{'dashboard.Messages.descriptionMessage' |
          translate}}</small>
        <small *ngIf="this.speaEmpForm.get('description')?.errors?.['maxlength']">{{'dashboard.Messages.maxLength' |
          translate}}</small>
      </div>
    </div>

    <div class="image-uploader__upload upload-btn">
      <app-file-upload (onFileUpload)="messageUpload($event)" [filesLimit]="4"
        (onFileDelete)="messageDeleted($event)"></app-file-upload>
    </div>

  </div>

</form>

<!-- -------------------------------------- -->

<form [formGroup]="parentForm" *ngIf="currentUserscope == 'Guardian'">
  <div class="custom-form custom-validation-form">
    <div class=" mb-5">
      <label class="label" for="">{{'dashboard.Messages.Enter the message title' | translate}} <span class="star">*</span></label>
      <input maxlength="32" class="form-control py-s" type="text" formControlName="title"
        placeholder="{{'dashboard.Messages.Enter the message title' | translate}}">
      <div class="text-danger"
        *ngIf="this.parentForm.get('title')?.touched && this.parentForm.get('title')?.invalid && this.parentForm.get('title')?.errors">
        <small *ngIf="this.parentForm.get('title')?.errors?.['required']">{{'dashboard.Messages.descriptionMessage' |
          translate}}</small>
        <small *ngIf="this.parentForm.get('title')?.errors?.['maxlength']">{{'dashboard.Messages.maxLengtho' |
          translate}}</small>
      </div>
    </div>

    <div class="mb-5">
      <label class="label" for="">{{'dashboard.Messages.Enter the text of the message' | translate}} <span
          class="star">*</span></label>
      <textarea maxlength="512" class="form-control" formControlName="description"
        placeholder="{{'dashboard.Messages.Enter the text of the message' | translate}}" rows="5" cols="30"
        pInputTextarea></textarea>
      <div class="text-danger"
        *ngIf="parentForm.get('description')?.touched && parentForm.get('description')?.invalid && parentForm.get('description')?.errors">
        <small *ngIf="parentForm.get('description')?.errors?.['required']">{{'dashboard.Messages.descriptionMessage' |
          translate}}</small>
        <small *ngIf="parentForm.get('description')?.errors?.['maxlength']">{{'dashboard.Messages.maxLength' |
          translate}}</small>
      </div>
    </div>

    <div class="mb-5">
      <label class="label" for="">{{'dashboard.Messages.MessageType' | translate}} <span class="star">*</span></label>
      <p-dropdown [options]="messagesTypes" [filter]="true"  [ngClass]="{'ng-invalid ng-dirty':parentForm.get('messageType')?.errors?.['required']&& parentForm.get('messageType')?.touched}"
      filterBy="{{lang=='ar'? 'name.ar' : 'name.en'}}" optionLabel="{{lang=='ar'? 'name.ar' : 'name.en'}}" formControlName="messageType"
        placeholder="{{'dashboard.Messages.MessageType' | translate}}" optionValue="id" ></p-dropdown>
      <div class="text-danger"
        *ngIf="this.parentForm.get('messageType')?.touched && this.parentForm.get('messageType')?.invalid && this.parentForm.get('messageType')?.errors">
        <small
          *ngIf="this.parentForm.get('messageType')?.errors?.['required']">{{'dashboard.Messages.descriptionMessage' |
          translate}}</small>
      </div>
    </div>

    <div class="image-uploader__upload upload-btn">


      <app-file-upload (onFileUpload)="messageUpload($event)" [filesLimit]="4"
        (onFileDelete)="messageDeleted($event)"></app-file-upload>
    </div>

  </div>
</form>

<!-- -------------------------------------- -->


<form [formGroup]="schoolEmpForm" *ngIf="currentUserscope== 'Employee'">
  <div class="custom-form custom-validation-form">
    <div class="mb-5  position-relative">
      <label class="label required" for="">{{'dashboard.Messages.add guardian' | translate}}</label>
      <div class="position-relative">
        <p-autoComplete formControlName="guardian" [suggestions]="autoCompleteForParent" field="name.ar"
          virtualScroll="true" virtualScrollItemSize="6" [multiple]="true"  [ngClass]="{'ng-invalid ng-dirty':schoolEmpForm.get('guardian')?.errors?.['required']&& schoolEmpForm.get('guardian')?.touched}"
          (completeMethod)="search($event)"  placeholder="بحث"></p-autoComplete>
          <i [style.top.%]="35" class="pi pi-search fs-3 position-absolute mx-3" ></i>
      </div>

      <div class="text-danger"
        *ngIf="this.schoolEmpForm.get('guardian')?.touched && this.schoolEmpForm.get('guardian')?.invalid && this.schoolEmpForm.get('guardian')?.errors">
        <small
          *ngIf="this.schoolEmpForm.get('guardian')?.errors?.['required']">{{'dashboard.Messages.descriptionMessage' |
          translate}}</small>
      </div>
    </div>

    <div class="mb-5">
      <label class="label">{{'dashboard.Messages.Enter the message title' | translate}} <span class="star">*</span></label>
      <input maxlength="32" class="form-control py-s" type="text" formControlName="title"
        placeholder="{{'dashboard.Messages.Enter the message title' | translate}}">
      <div class="text-danger"
        *ngIf="this.schoolEmpForm.get('title')?.touched && this.schoolEmpForm.get('title')?.invalid && this.schoolEmpForm.get('title')?.errors">
        <small *ngIf="this.schoolEmpForm.get('title')?.errors?.['required']">{{'dashboard.Messages.descriptionMessage' |
          translate}}</small>
        <small *ngIf="this.schoolEmpForm.get('title')?.errors?.['maxlength']">{{'dashboard.Messages.maxLengtho' |
          translate}}</small>
      </div>
    </div>

    <div class="mb-5">
      <label class="label">{{'dashboard.Messages.MessageType' | translate}} <span class="star">*</span></label>
      <p-dropdown [options]="messagesTypes" [filter]="true" [ngClass]="{'ng-invalid ng-dirty':schoolEmpForm.get('messageType')?.errors?.['required']&& schoolEmpForm.get('messageType')?.touched}"
      filterBy="{{lang=='ar'? 'name.ar' : 'name.en'}}" optionLabel="{{lang=='ar'? 'name.ar' : 'name.en'}}" formControlName="messageType"
        placeholder="{{'dashboard.Messages.MessageType' | translate}}" optionValue="id" ></p-dropdown>
      <div class="text-danger"
        *ngIf="this.schoolEmpForm.get('messageType')?.touched && this.schoolEmpForm.get('messageType')?.invalid && this.schoolEmpForm.get('messageType')?.errors">
        <small
          *ngIf="this.schoolEmpForm.get('messageType')?.errors?.['required']">{{'dashboard.Messages.descriptionMessage'
          | translate}}</small>
      </div>
    </div>

    <div class="d-flex El-form my-4">
      <div class=" d-flex">
        <label class="px-3 label" for=""> {{'dashboard.Messages.Possibility to reply' | translate}} <span
            class="star">*</span></label>
        <p-inputSwitch (onChange)="isToggleLabel1($event)" class="px-3" formControlName="switch2"></p-inputSwitch>
        <span class="Label" *ngIf="!isShown1">{{'shared.no'|translate}}</span>
        <span class="Label" *ngIf="isShown1">{{'shared.yes'|translate}}</span>
      </div>
    </div>

    <div class="mb-5">
      <label class="label required">{{'dashboard.Messages.Enter the text of the message' | translate}}</label>
      <textarea maxlength="512" class="form-s form-control" formControlName="description"
        placeholder="{{'dashboard.Messages.Enter the text of the message' | translate}}" rows="5" cols="30"
        pInputTextarea></textarea>
      <div class="text-danger"
        *ngIf="this.schoolEmpForm.get('description')?.touched && this.schoolEmpForm.get('description')?.invalid && this.schoolEmpForm.get('description')?.errors">
        <small
          *ngIf="this.schoolEmpForm.get('description')?.errors?.['required']">{{'dashboard.Messages.descriptionMessage'
          | translate}}</small>
        <small *ngIf="this.schoolEmpForm.get('description')?.errors?.['maxlength']">{{'dashboard.Messages.maxLength' |
          translate}}</small>
      </div>
    </div>

    <div class="image-uploader__upload upload-btn">

      <app-file-upload (onFileUpload)="messageUpload($event)" [filesLimit]="4"
        (onFileDelete)="messageDeleted($event)"></app-file-upload>
    </div>

  </div>
</form>


<div class="d-flex justify-content-end">
  <button (click)="sendMessage()" class="btn btn-primary"
    [disabled]="(currentUserscope == 'SPEA' && (speaEmpForm.invalid || MarkedListLength==0))||(parentForm.invalid && currentUserscope == 'Guardian' )||(schoolEmpForm.invalid&& currentUserscope == 'Employee') ||onSubmit">
    {{'dashboard.Messages.Send' |translate}}
    <div class="spinner-border text-light" role="status" *ngIf="onSubmit"></div>

  </button>
</div>
