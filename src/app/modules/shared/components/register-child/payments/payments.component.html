

<ng-container *permit="claimsEnum.E_Acc_R_StudentPayments">

    <ng-container *ngIf="mode=='view'">
        
        <ng-container *ngIf="!(student$ |async)">
            <div class="row g-5">
                <div class="col-md-4">
                    <app-skeleton count="2" [style]="{'margin-bottom': '3rem'}"></app-skeleton>
                </div>
                <div class="col-md-4">
                    <app-skeleton count="2" [style]="{'margin-bottom': '3rem'}" ></app-skeleton>
                </div>
                <div class="col-md-4">
                    <app-skeleton count="2"  [style]="{'margin-bottom': '3rem'}"></app-skeleton>
                </div>
            </div>
    
        </ng-container>
    
    
        <ng-container *ngIf="(student$ |async) as student">
            
            <div class="row gx-5 p-4 bg-gray-30 mt-6 radius-15" >
                <div class="d-flex justify-content-between align-items-center">
                    <h3 class="heading heading--tertiary mb-4">{{'students.payments'|translate}}</h3>
                    <div class="float-btn " (click)="mode='edit'; modeChange.emit(mode)" *permit="claimsEnum.E_Acc_U_StudentPayments">
                        <img src="assets/images/shared/pen-blue-filled.svg" alt="">
                    </div>
    
                </div>
                <div class="col d-flex align-items-center gap-3">
                    <p class="color-gray-300 fs-4">{{ 'parents.paidAmount'|translate }}</p>
                    <span class="color-primary mb-2">{{student?.studentPayments?.paidAmount ||0}} {{'issue of certificate.dirham'|translate}}</span>
                </div>
                <div class="col d-flex align-items-center gap-3">
                    <p class="color-gray-300 fs-4">{{ 'parents.requiredAmount'|translate }}</p>
                    <span class="color-primary mb-2">{{student?.studentPayments?.fullAmountToBePaid ||0}} {{'issue of certificate.dirham'|translate}}</span>
                </div>
                <div class="col d-flex align-items-center gap-3">
                    <p class="color-gray-300 fs-4">{{ 'parents.restAmount'|translate }}</p>
                    <span class="color-primary mb-2">{{student?.studentPayments?.remainingAmount ||0}} {{'issue of certificate.dirham'|translate}}</span>
                </div>
                <div class="col d-flex align-items-center gap-4" *ngIf="student?.studentPayments?.accountantComment">
                    <p class="color-gray-800 fs-4 fw-bold">{{'parents.accountantComment'|translate }}</p>
                    <span class="mb-2">
                      <a class="color-skyBlue-500 " (click)="isAccountantCommentModel=true">{{'parents.viewComment'|translate}}</a>
                  </span>
                </div>
            </div>
        </ng-container>
    </ng-container>
</ng-container>




<ng-container *ngIf="mode=='edit'">
    <!-- *permit="claimsEnum.E_Accountant" -->
    <div class="row gx-5 p-4 mt-6 bg-gray-30 radius-15" [formGroup]="studentForm" >
        <ng-container formGroupName="studentPayments">
            <h3 class="heading heading--tertiary mb-4">{{'students.payments'|translate}}</h3>
            <div class="col-md-4">
                <label class="label" for="trackId">{{'parents.requiredAmount'|translate}}</label>
                <p-inputNumber  formControlName="fullAmountToBePaid" suffix="{{'issue of certificate.dirham'|translate}}" placeholder="{{ 'shared.chooseRequiredAmount' |translate}}"></p-inputNumber>
            </div>
            <div class="col-md-4">
                <label class="label" for="trackId">{{'parents.paidAmount'|translate}}</label>
                <p-inputNumber formControlName="paidAmount" suffix="{{'issue of certificate.dirham'|translate}}" placeholder="{{ 'shared.chooseRequiredAmount' |translate}}"></p-inputNumber>
            </div>
    
            <div class="col-md-4">
                <label class="label" for="trackId">{{'parents.restAmount'|translate}}</label>
                <p-inputNumber formControlName="remainingAmount"  suffix="{{'issue of certificate.dirham'|translate}}" placeholder="{{ 'shared.chooseRequiredAmount' |translate}}"></p-inputNumber>
            </div>
    
            <div class="col-md-12 mt-4">
                <label class="label" for="trackId">{{'parents.accountantComment'|translate}}</label>
                <textarea formControlName="accountantComment" [rows]="5" pInputTextarea pInputText placeholder="{{'parents.accountantComment'|translate}}"></textarea>
            </div>
        </ng-container>


        <div class="d-flex justify-content-end mt-5">
            <button class="btn btn-primary " 
            [disabled]="(this.childService.loading$ |async) || !studentForm.valid" 
            (click)="onFormSubmitted.emit()">
                <span>{{'shared.saveChanges'| translate}}</span>
                <div class="spinner-border text-light" role="status" *ngIf="this.childService.loading$ |async"></div>
            </button>
            <button  (click)="mode='view'"><a class="cancelbtn mx-4">{{'shared.Cancel'|translate}}</a></button>
        </div>
    </div>
</ng-container>







<p-dialog header="{{'parents.accountantComment' | translate}}" [(visible)]="isAccountantCommentModel" [draggable]="false" [modal]="true" [style]="{width: '40vw'}">

    <ng-template pTemplate="content">
        <div class="custom-form mt-5" *ngIf="student$ |async as student" [formGroup]="studentForm">
            <!-- <label class="label">{{'parents.accountantComment' | translate}}</label> -->
            <p class="paragraph paragraph--sm color-gray-800 mb-6 w-75">
                {{student?.studentPayments?.accountantComment}}
            </p>
        </div>
    </ng-template>

</p-dialog>
