<div class="survey p-5 radius-15 border-dark">
    <ng-container *ngIf="!editSurvey">
        <div class="row g-5 mt-5">
          <app-skeleton count="6" [style]="{'margin-bottom': '3rem'}"></app-skeleton>
        </div>

     </ng-container>

    <div class="survey__content my-5 rounded custom-form custom-validation-form container-fluid" *ngIf="editSurvey">

        <form  [formGroup]="surveyFormGrp">
            <ng-container >
                <div class="mt-5 d-flex  align-items-center justify-content-end " *ngIf="editSurvey?.surveyStatus==StatusEnum.Draft">
                    <button type="button" class="btn btn-primary mx-3" [disabled]="!surveyFormGrp.valid||!savedGuardianIds?.length||isBtnLoading" (click)="openMessage()" icon="pi pi-info-circle" label="Show">
                    <span>{{'dashboard.surveys.Send survey'| translate}} </span>
                    <div class="spinner-border text-light" role="status" [hidden]="!isBtnLoading"></div>
                  </button>

                </div>
            </ng-container>

            <ng-container >

                <div class="row gx-5 form-set">
                    <div class="col-md-4">
                        <label class="label" for="day">{{'dashboard.surveys.SurveyAppearanceDateAndTime'|translate}} <span class="star">*</span></label>
                        <p-calendar formControlName="appearanceDate"  [showTime]="true"  *ngIf="editSurvey?.surveyStatus!=StatusEnum.Draft&&surveyId" [disabled]="true" [ngClass]="{'ng-invalid ng-dirty':appearanceDate.errors?.['required'] &&appearanceDate.touched}"  [showIcon]="true" inputId="icon" [minDate]="currentDate" [maxDate]="disAppearanceDate.value"  placeholder="{{'dashboard.surveys.SurveyAppearanceDateAndTime'|translate}}" [readonlyInput]="true" dateFormat="dd/mm/yy"></p-calendar>
                        <p-calendar formControlName="appearanceDate" [showTime]="true"   *ngIf="editSurvey?.surveyStatus==StatusEnum.Draft||!surveyId"  [ngClass]="{'ng-invalid ng-dirty':appearanceDate.errors?.['required'] &&appearanceDate.touched}"  [showIcon]="true" inputId="icon" [minDate]="currentDate" [maxDate]="disAppearanceDate.value"  placeholder="{{'dashboard.surveys.SurveyAppearanceDateAndTime'|translate}}" [readonlyInput]="true" dateFormat="dd/mm/yy"></p-calendar>
                        <div>

                            <div [hidden]="appearanceDate.valid || appearanceDate.untouched">
                                <small *ngIf="appearanceDate.errors?.['required']"  id="helpId" class="form-text text-muted d-block  " class="alert-danger">
                                  {{'shared.This Field is Required'|translate}}
                                   <fa-icon  [icon]=" exclamationIcon"  class="dangericon ms-1 "></fa-icon>
                                </small>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <label class="label" for="day">{{'dashboard.surveys.SurveyDisAppearanceDateAndTime'|translate}} <span class="star">*</span></label>
                        <p-calendar formControlName="disAppearanceDate" [showTime]="true" [disabled]="true" *ngIf="editSurvey?.surveyStatus!=StatusEnum.Draft&&surveyId" [ngClass]="{'ng-invalid ng-dirty':disAppearanceDate.errors?.['required'] && disAppearanceDate.touched}" [showIcon]="true" inputId="icon"  [minDate]="appearanceDate.value"   placeholder="{{'dashboard.surveys.SurveyDisAppearanceDateAndTime'|translate}}" [readonlyInput]="true" dateFormat="dd/mm/yy"></p-calendar>
                        <p-calendar formControlName="disAppearanceDate" [showTime]="true"  *ngIf="editSurvey?.surveyStatus==StatusEnum.Draft||!surveyId"  [ngClass]="{'ng-invalid ng-dirty':disAppearanceDate.errors?.['required'] && disAppearanceDate.touched}" [showIcon]="true" inputId="icon"  [minDate]="appearanceDate.value"   placeholder="{{'dashboard.surveys.SurveyDisAppearanceDateAndTime'|translate}}" [readonlyInput]="true" dateFormat="dd/mm/yy"></p-calendar>
                        <div>
                            <div [hidden]="disAppearanceDate.valid || disAppearanceDate.untouched">
                                <small *ngIf="disAppearanceDate.errors?.['required']"  id="helpId" class="form-text text-muted d-block  " class="alert-danger">
                                  {{'shared.This Field is Required'|translate}}
                                   <fa-icon  [icon]=" exclamationIcon"  class="dangericon ms-1 "></fa-icon>
                                </small>
                            </div>
                        </div>
                    </div>
                </div>

                <hr class="color-gray-400 mb-4">

            </ng-container>

        </form>

        <ng-container>

            <div>
                <p class="fw-bold mb-4" *ngIf="editSurvey?.surveyStatus==StatusEnum.Draft||!surveyId">{{'dashboard.parents.selectParents'|translate}}</p>
                <p class="fw-bold mb-4"  *ngIf="editSurvey?.surveyStatus!=StatusEnum.Draft&&surveyId">{{'dashboard.parents.parents'|translate}}</p>
                <ng-container *ngIf="!parent.totalAllData && !parent.loading">
                    <app-informative-block title="{{'emptyList.Parent List is empty' |translate}}" src="assets/images/empty-list/empty-list.svg"></app-informative-block>
                </ng-container>


                <div class="custom-form parent-modal" *ngIf="parent.totalAllData || parent.loading">

                  <app-table-caption [seachKeyword]="filtration.KeyWord" [hasExport]="false"
                    (onFilter)="parent.list=[];filtration.Page=0;getParentList()"
                    (onSearch)="parent.list=[];filtration.Page=0;filtration.KeyWord = $event; getParentList()"
                    (onClear)="clearFilter()">
                    <div class="row gx-5 form-set">


                      <div class="col-md-4">
                        <label class="label">{{'dashboard.students.classes'| translate}}</label>
                        <p-multiSelect [options]="(AllGrades$ | async)" display="chip" [(ngModel)]="filtration.gradeId"
                          optionLabel="{{lang=='ar'? 'name.ar' :'name.en'}}" optionValue="id"
                          placeholder="{{'dashboard.students.chooseClasse' |translate}}"></p-multiSelect>
                      </div>

                      <div class="col-md-4">
                        <label class="label" for="schools">{{'Schools'|translate }} </label>
                        <p-multiSelect [options]="(schools$| async)?.data" display="chip" [(ngModel)]="filtration.schoolId"
                          optionLabel="{{lang=='ar'? 'name.ar' :'name.en'}}" optionValue="id"
                          placeholder="{{'shared.chooseSchool'|translate }}"></p-multiSelect>
                      </div>

                      <div class="col-md-4">
                        <label class="label" for="schools">{{'shared.personalId'|translate }} </label>
                        <input type="text" [(ngModel)]="filtration.emiretesId" pInputText class="form-control"
                          (ngModelChange)="getParentList()" [LangRestrict]="'ar'"
                          placeholder="{{'sign up.enter personal digitalIdentity' | translate}}" name="PID7" id="PID7">
                      </div>

                    </div>
                  </app-table-caption>

                  <div class=" p-5 " >
                    <div *ngIf="!parent.list.length">
                      <ng-container *ngIf="parent.totalAllData && parent.list.length == 0 &&  !parent.loading">
                        <app-informative-block title="{{'emptyList.noDataMatch' |translate}}"
                          src="assets/images/empty-list/empty-list.svg"></app-informative-block>
                      </ng-container>

                      <app-loader></app-loader>
                    </div>


                    <div class="contain"
                    *ngIf="parent.list.length"
                      [ngClass]="parent.list.length>25 ? 'scroll':''"
                      infiniteScroll
                      [infiniteScrollDistance]="1"
                      [infiniteScrollThrottle]="500"
                      [scrollWindow]="false"
                      (scrolled)="onScroll()" >

                      <div class="d-flex" *ngIf="editSurvey?.surveyStatus==StatusEnum.Draft||!surveyId">
                        <p-checkbox binary="true" (onChange)="selectAllParents($event)"></p-checkbox>
                        <span class="mx-3 ">{{'shared.selectAll'|translate}}</span>
                      </div>

                      <div class="form-set mt-5">
                        <div class="row g-5 ">
                          <ng-container *ngFor="let item of parent.list; let i = index">
                            <div class="col-md-4 d-flex gap-4 align-items-center">

                              <p-checkbox [value]="item.id" *ngIf="editSurvey?.surveyStatus==StatusEnum.Draft||!surveyId" name="parents" [(ngModel)]="savedGuardianIds"></p-checkbox>

                              <p-checkbox [value]="item.id" *ngIf="editSurvey?.surveyStatus!=StatusEnum.Draft&&surveyId" name="parents"[disabled]="true" [(ngModel)]="savedGuardianIds"></p-checkbox>
                              <label  for=""> {{item.name|currentLang}} </label>
                            </div>
                          </ng-container>

                          <div class="row g-5" *ngIf="parent.loading">
                            <div class="col-md-4">
                              <app-skeleton count="8" width="75%" height="1.5rem" [style]="{'margin-bottom': '2rem'}"></app-skeleton>
                            </div>
                            <div class="col-md-4">
                              <app-skeleton count="8" width="75%" height="1.5rem" [style]="{'margin-bottom': '2rem'}"></app-skeleton>
                            </div>
                            <div class="col-md-4">
                              <app-skeleton count="8" width="75%" height="1.5rem" [style]="{'margin-bottom': '2rem'}"></app-skeleton>
                            </div>
                          </div>
                        </div>

                      </div>

                    </div>
                  </div>
                </div>
            </div>

        </ng-container>

    </div>

</div>
