<div class="survey">
    <ng-container *ngIf="!editSurvey">
        <div class="row g-5 mt-5">
           
                <app-skeleton count="6"  [style]="{'margin-bottom': '3rem'}"></app-skeleton>
        
        </div>
    
     </ng-container>
 
    <div class="survey__content my-5 rounded custom-form custom-validation-form container" *ngIf="editSurvey">

        <form  [formGroup]="surveyFormGrp">
            <ng-container >
                <div class="mt-5 d-flex  align-items-center justify-content-end " *ngIf="editSurvey?.surveyStatus==StatusEnum.New">
                    <button type="button" class="btn btn-primary mx-3" [disabled]="!surveyFormGrp.valid||!savedGuardianIds?.length||isBtnLoading" (click)="openMessage()" icon="pi pi-info-circle" label="Show">
                    <span>{{'dashboard.surveys.Send survey'| translate}} </span>
                    <div class="spinner-border text-light" role="status" [hidden]="!isBtnLoading"></div>
                  </button>
                    
                </div>
            </ng-container>

            <ng-container >

                <div class="row gx-5 form-set">
                    <div class="col-md-4">
                        <label class="label" for="day">{{'dashboard.surveys.Survey appearanceDate'|translate}} <span class="star">*</span></label>
                        <p-calendar formControlName="appearanceDate" *ngIf="editSurvey?.surveyStatus!=StatusEnum.New&&surveyId" [disabled]="true" [ngClass]="{'ng-invalid ng-dirty':appearanceDate.errors?.['required'] &&appearanceDate.touched}"  [showIcon]="true" inputId="icon" [minDate]="currentDate" [maxDate]="disAppearanceDate.value"  placeholder="{{'dd/mm/yy'|translate}}" [readonlyInput]="true" dateFormat="dd/mm/yy"></p-calendar>
                        <p-calendar formControlName="appearanceDate" *ngIf="editSurvey?.surveyStatus==StatusEnum.New||!surveyId"  [ngClass]="{'ng-invalid ng-dirty':appearanceDate.errors?.['required'] &&appearanceDate.touched}"  [showIcon]="true" inputId="icon" [minDate]="currentDate" [maxDate]="disAppearanceDate.value"  placeholder="{{'dd/mm/yy'|translate}}" [readonlyInput]="true" dateFormat="dd/mm/yy"></p-calendar>
                        <div>
                            
                            <div [hidden]="appearanceDate.valid || appearanceDate.untouched">
                                <small *ngIf="appearanceDate.errors?.['required']"  id="helpId" class="form-text text-muted d-block  " class="alert-danger">
                                  {{'shared.This Field is Required'|translate}}
                                   <fa-icon  [icon]=" exclamationIcon"  class="dangericon ms-1 "></fa-icon>
                                </small>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <label class="label" for="day">{{'dashboard.surveys.Survey appearanceTime'|translate}} <span class="star">*</span></label>
                        <p-calendar formControlName="appearanceTime" [minDate]="appearanceDate.value"  *ngIf="editSurvey?.surveyStatus!=StatusEnum.New&&surveyId" [disabled]="true" [ngClass]="{'ng-invalid ng-dirty':appearanceTime.errors?.['required'] &&appearanceTime.touched}" icon="pi pi-clock" [timeOnly]="true" showIcon="true"  [hourFormat]="24" inputId="timeonly"></p-calendar>
                        <p-calendar formControlName="appearanceTime" [minDate]="appearanceDate.value"  (onFocus)="currentApperanceTime()" *ngIf="editSurvey?.surveyStatus==StatusEnum.New||!surveyId" [ngClass]="{'ng-invalid ng-dirty':appearanceTime.errors?.['required'] &&appearanceTime.touched}" icon="pi pi-clock" [timeOnly]="true" showIcon="true"  [hourFormat]="24" inputId="timeonly"></p-calendar>
                        <div>
                          
                            <div [hidden]="appearanceTime.valid || appearanceTime.untouched">
                                <small *ngIf="appearanceTime.errors?.['required']"  id="helpId" class="form-text text-muted d-block  " class="alert-danger">
                                  {{'shared.This Field is Required'|translate}}
                                   <fa-icon  [icon]=" exclamationIcon"  class="dangericon ms-1 "></fa-icon>
                                </small>
                            </div>
                        </div>
                    </div>
                </div>

               

                <div class="row gx-5 form-set">
                    <div class="col-md-4">
                        <label class="label" for="day">{{'dashboard.surveys.Survey disAppearanceDate'|translate}} <span class="star">*</span></label>
                        <p-calendar formControlName="disAppearanceDate" [disabled]="true" *ngIf="editSurvey?.surveyStatus!=StatusEnum.New&&surveyId" [ngClass]="{'ng-invalid ng-dirty':disAppearanceDate.errors?.['required'] && disAppearanceDate.touched}" [showIcon]="true" inputId="icon"  [minDate]="appearanceDate.value"   placeholder="{{'dd/mm/yy'|translate}}" [readonlyInput]="true" dateFormat="dd/mm/yy"></p-calendar>
                        <p-calendar formControlName="disAppearanceDate" *ngIf="editSurvey?.surveyStatus==StatusEnum.New||!surveyId"  [ngClass]="{'ng-invalid ng-dirty':disAppearanceDate.errors?.['required'] && disAppearanceDate.touched}" [showIcon]="true" inputId="icon"  [minDate]="appearanceDate.value"   placeholder="{{'dd/mm/yy'|translate}}" [readonlyInput]="true" dateFormat="dd/mm/yy"></p-calendar>
                        <div>
                            <div [hidden]="disAppearanceDate.valid || disAppearanceDate.untouched">
                                <small *ngIf="disAppearanceDate.errors?.['required']"  id="helpId" class="form-text text-muted d-block  " class="alert-danger">
                                  {{'shared.This Field is Required'|translate}}
                                   <fa-icon  [icon]=" exclamationIcon"  class="dangericon ms-1 "></fa-icon>
                                </small>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <label class="label" for="day">{{'dashboard.surveys.Survey disAppearanceTime'|translate}} <span class="star">*</span></label>
                        <p-calendar  formControlName="disAppearanceTime" *ngIf="editSurvey?.surveyStatus!=StatusEnum.New&&surveyId" [disabled]="true" [ngClass]="{'ng-invalid ng-dirty':disAppearanceTime.errors?.['required'] && disAppearanceTime.touched}" icon="pi pi-clock" [timeOnly]="true" showIcon="true" [hourFormat]="24" inputId="timeonly"></p-calendar>
                        <p-calendar  formControlName="disAppearanceTime" *ngIf="editSurvey?.surveyStatus==StatusEnum.New||!surveyId"  [ngClass]="{'ng-invalid ng-dirty':disAppearanceTime.errors?.['required'] && disAppearanceTime.touched}" icon="pi pi-clock" [timeOnly]="true" showIcon="true" [hourFormat]="24" inputId="timeonly"></p-calendar>
                        <div>
                            <div [hidden]="disAppearanceTime.valid || disAppearanceTime.untouched">
                                <small *ngIf="disAppearanceTime.errors?.['required']"  id="helpId" class="form-text text-muted d-block  " class="alert-danger">
                                  {{'shared.This Field is Required'|translate}}
                                   <fa-icon  [icon]=" exclamationIcon"  class="dangericon ms-1 "></fa-icon>
                                </small>
                            </div>
                        </div>
                    </div>
                </div>

                <hr class="color-gray-400 mb-4">

            </ng-container>

        </form>
          
            <ng-container>

                <div>
                    <p class="fw-bold mb-4" *ngIf="editSurvey?.surveyStatus==StatusEnum.New||!surveyId">{{'dashboard.parents.selectParents'|translate}}</p>
                    <p class="fw-bold mb-4"  *ngIf="editSurvey?.surveyStatus!=StatusEnum.New&&surveyId">{{'dashboard.parents.parents'|translate}}</p>
                    <ng-container *ngIf="!parent.totalAllData && !parent.loading">
                        <app-informative-block title="{{'emptyList.Parent List is empty' |translate}}" src="assets/images/empty-list/empty-list.svg"></app-informative-block>
                    </ng-container>
             
    
                <div class="custom-form parent-modal" *ngIf="parent.totalAllData || parent.loading">
                  
    
                   <div >
                       <app-table-caption [hasExport]="false" (onFilter)="filtration.Page=1;getParentList()" (onSearch)="filtration.Page=1;filtration.KeyWord = $event; getParentList()" (onClear)="clearFilter()">
                    
                        <div class="row gx-5 form-set">
    
                           
                        <div class="col-md-6">
                            <label class="label">{{'dashboard.students.classes'| translate}}</label>
                            <p-dropdown 
                            [options]="(AllGrades$ | async)" 
                            [(ngModel)]="filtration.gradeId" 
                            
                             optionValue="id"
                            optionLabel="name.ar" 
                            placeholder="{{'dashboard.students.chooseClasse' |translate}}" 
                            emptyMessage="لايوجد عناصر"></p-dropdown>
                        </div>
    
                            <div class="col-md-6">
                                <label class="label" for="schools">{{'Schools'|translate }}  </label>
                                <p-dropdown  [options]="(schools$| async)?.data" [(ngModel)]="filtration.schoolId" optionValue="id" inputId="schools" optionLabel="name.ar" placeholder="{{'shared.chooseSchool'|translate }}"></p-dropdown>
                            </div>
    
                        </div>
                        <div class="row gx-5 form-set">
    
        
                                <div class="col-md-12">
                                    <label class="label" for="schools">{{'shared.personalId'|translate }}  </label>
                                    <input type="text" [(ngModel)]="filtration.emiretesId" pInputText class="form-control"  [LangRestrict]="'ar'" placeholder="{{'sign up.enter personal digitalIdentity' | translate}}" name="PID7" id="PID7">
                                </div>
        
                            </div>
        
                    </app-table-caption>
                </div>
                <div  class="contain" [ngClass]="parent.list.length>6 ? 'scroll':''">
                    <div *ngIf="!parent.list.length">
                        <ng-container *ngIf="parent.totalAllData && parent.list.length == 0 &&  !parent.loading">
                            <app-informative-block title="{{'emptyList.noDataMatch' |translate}}" src="assets/images/empty-list/empty-list.svg"></app-informative-block>
                        </ng-container>
    
                        <app-loader></app-loader>
                    </div>
                    <div *ngIf="parent.list.length"> 
                    <div class="row gx-5 gy-4 form-set mt-5">
                        <ng-container *ngFor="let item of parent.list; let i = index">
                            <div class="col-md-4 d-flex gap-4 align-items-center">
                                <p-checkbox  [value]="item.id" *ngIf="editSurvey?.surveyStatus==StatusEnum.New||!surveyId" name="parents"   [(ngModel)]="savedGuardianIds"></p-checkbox>
                                <p-checkbox  [value]="item.id" *ngIf="editSurvey?.surveyStatus!=StatusEnum.New&&surveyId" name="parents" [disabled]="true"  [(ngModel)]="savedGuardianIds"></p-checkbox>
                                <label class="label label--sm" for=""> {{item.name|currentLang}} </label>
                            </div>
                        </ng-container>
    
                    </div>
                  
                </div>
            </div>
          </div>
        </div>

            </ng-container>
          

       
    </div>

</div>
