<div class="radius-15 border p-5 mb-5 bg-white">

    <!-- <app-add-btn fs-4 [backGroundColor]="'btn-primary'" [route]="'register'" [content]="'breadcrumb.Studentregister'"></app-add-btn> -->
    <div class="d-flex align-items-center justify-content-between bg-white">
        <div class="profile d-flex align-items-center">
            <input type="file" 
            #uploadImg 
            accept="image/*" 
            [hidden]="true" 
            (change)="uploadProfileImage($event)">
            <div *ngIf="currentUserScope!=userScope.Guardian" class="profile__avatar position-relative" >
                <img [src]="child?.imagePath" onerror="this.src='assets/images/shared/image.svg'" alt="Avatar">
            </div>

            <div *ngIf="currentUserScope==userScope.Guardian" class="profile__avatar position-relative"  (click)="uploadImg.value=null; uploadImg.click()">
                <i class="pi pi-camera" style="font-size: 2.5rem"></i>
                <div class="loader" *ngIf="uploading">
                    <div class="spinner-border text-light" role="status"></div>
                </div>
                <img [src]="child?.imagePath" onerror="this.src='assets/images/shared/image.svg'" alt="Avatar">
            </div>

            <div class="profile__info">
                <div class="profile__name ">
                    <h4 class="heading heading--tertiary">{{child?.name.ar}}</h4>
                </div>
                <div class="profile__details">
                    <div class="fs-4">
                        <img src="assets/images/shared/child.svg" alt="">
                        <span class="color-gray-300">{{child?.age}} سنة</span>
                    </div>
                    <div>
                        <!-- <img *ngIf="student.regestered" src="assets/images/shared/fingure.svg" alt=""> -->
                        <img src="assets/images/shared/fingure-red.svg" alt="">
                        <span class="color-red-500 fs-4">غير مسجل</span>
                    </div>

                </div>

            </div>
        </div>

        <div class="actions d-flex align-items-center gap-3 mb-5">

            <ng-container *permit="claimsEnum.G_DeleteChild">
                <button class="btn btn-primary bg-skyBlue-600 btn--sm px-5" (click)="openDeleteModel()">
                    <span>حــذف  </span>
                </button>
            </ng-container>

            <ng-container>
                <button class="btn btn-primary btn--sm px-5"  (click)="navigateToRequestPage()">
                    <span>سجل الطالب فى المدرسه </span>
                </button>
            </ng-container>

            <ng-container *ngIf="editMode || AttachmentEditMode">
                <button class="btn btn-primary btn--sm px-5" [disabled]="!childForm.valid || onSubmit" (click)="updateChild(childForm.value)">
                    {{'shared.saveChanges' | translate}}
                    <div class="spinner-border text-light" role="status" *ngIf="onSubmit"></div>
                </button>
            </ng-container>

        </div>
    </div>

</div>



<div class="tabView">

    <!-- Navigations Options -->
    <ul class="tabView__nav">
        <li class="tabView__nav__link" [class.active]="step==1" (click)="step=1"><span>{{ 'dashboard.parents.personalInfo'|translate }}</span></li>
        <li class="tabView__nav__link" [class.active]="step==2" (click)="step=2;"><span>{{ 'dashboard.parents.sonAttachments'|translate }}</span></li>
        <li class="tabView__nav__link" [class.active]="step==3" (click)="step=3"><span> {{ 'dashboard.parents.requests'|translate }}</span></li>

    </ul>

    <div class="tabView__content">
        <!-- In case student Not Registered -->

        <ng-container *ngIf="step==1">
            <ng-container *ngIf="!child">
                <div class="row g-5">
                    <div class="col-md-4">
                        <app-skeleton count="3" [style]="{'margin-bottom': '3rem'}"></app-skeleton>
                    </div>
                    <div class="col-md-4">
                        <app-skeleton count="3" [style]="{'margin-bottom': '3rem'}"></app-skeleton>
                    </div>
                    <div class="col-md-4">
                        <app-skeleton count="3" [style]="{'margin-bottom': '3rem'}"></app-skeleton>
                    </div>
                </div>
                
            </ng-container>

            <ng-container *ngIf="!editMode && child">
                <div class="float-btn" *ngIf="!editMode" (click)="editMode=true">
                    <img src="assets/images/shared/pen-blue-filled.svg" alt="">
                </div>
                <div class="">
                    <div class="row g-5">
                        <div class="col-3 d-flex align-items-center gap-5">
                            <p class="color-gray-300 fs-4">{{ 'dashboard.parents.childName'|translate }}</p>
                            <h4 class="color-primary mb-2">{{child?.name |currentLang}}</h4>
                        </div>
                        <div class="col-3 d-flex align-items-center gap-5">
                            <p class="color-gray-300 fs-4">{{ 'dashboard.parents.nickname'|translate }}</p>
                            <h4 class="color-primary mb-2">{{child?.surname |currentLang}}</h4>
                        </div>
                        <div class="col-2 d-flex align-items-center gap-5">
                            <p class="color-gray-300 fs-4">{{ 'shared.gender'|translate }}</p>
                            <h4 class="color-primary mb-2">{{child?.gender=='Female' ? ('shared.genderType.Female'|translate): 'shared.genderType.Male'|translate}}</h4>
                        </div>
                        <div class="col-3 d-flex align-items-center gap-5">
                            <p class="color-gray-300 fs-4">{{'shared.birthDay'|translate }}</p>
                            <h4 class="color-primary mb-2">{{child?.birthDate | LocalizeDate}}</h4>
                        </div>
                        <div class="col-3 d-flex align-items-center gap-5" *ngIf="child.emiratesId">
                            <p class="color-gray-300 fs-4">{{ 'shared.personalId'|translate }}</p>
                            <h4 class="color-primary mb-2">{{child?.emiratesId}}</h4>
                        </div>

                        <div class="col-3 d-flex align-items-center gap-5" *ngIf="!child.emiratesId">
                            <p class="color-gray-300 fs-4">{{ 'TheReasonForLackOfIdentification'|translate }}</p>
                            <h4 class="color-primary mb-2">{{child?.reasonForNotHavingEmirates?.name |currentLang}}</h4>
                        </div>

                        <div class="col-3 d-flex align-items-center gap-5">
                            <p class="color-gray-300 fs-4">{{ 'shared.nationality'|translate }}</p>
                            <h4 class="color-primary mb-2">{{child?.nationlity?.name |currentLang}}</h4>
                        </div>
    
                        <div class="col-2 d-flex align-items-center gap-5">
                            <p class="color-gray-300 fs-4">{{ 'dashboard.parents.relatedType'|translate }}</p>
                            <h4 class="color-primary mb-2">{{child?.relativeRelation?.name |currentLang }}</h4>
                        </div>
    
                        <div class="col-3 d-flex align-items-center gap-5">
                            <p class="color-gray-300 fs-4">{{ 'shared.passportId'|translate }}</p>
                            <h4 class="color-primary mb-2">{{child?.passportNumber}}</h4>
                        </div>
                    </div>
                </div>
            </ng-container>
            <ng-container *ngIf="editMode">
                <div class="row g-5 custom-form" [formGroup]="childForm">

                        <div class="form-set  col-md-4" formGroupName="name">
                            <label class="label">{{'dashboard.parents.childName'|translate}}</label>
                            <input type="text" formControlName="ar"  pInputText placeholder="{{'dashboard.students.studentName'|translate}}" />
                        </div>
            
                        <div class="form-set col-md-4" formGroupName="surname">
                            <label class="label">{{'dashboard.parents.nickname'|translate}}</label>
                            <input type="text" formControlName="ar" pInputText placeholder="{{'dashboard.students.studentNickname'|translate}}" />
                        </div>
                        <div class="form-set col-md-4">
                            <label class="label">{{'shared.gender'|translate}}</label>
                            <p-dropdown formControlName="gender" [options]="genderOptions" optionValue="value" optionLabel="name"></p-dropdown>
                        </div>
            
                        <div class="form-set col-md-4">
                            <label class="label">{{'shared.birthDay'|translate}}</label>
                            <p-calendar formControlName="birthDate" [style]="{'font-size': '1.6rem'}" icon="pi pi-clock" [showIcon]="true" placeholder="2002/07/04"></p-calendar>
                        </div>
            
            
                        <div class="form-set col-md-4">
                            <label class="label">{{'shared.nationality'|translate}}</label>
                            <!-- <input type="text" formControlName="nationalityId" pInputText placeholder="اماراتى" /> -->
                            <p-dropdown formControlName="nationlityId" [options]="countries$ |async" optionValue="id" optionLabel="{{lang=='ar'? 'name.ar' : 'name.en'}}"></p-dropdown>
                        </div>
        
                        <div class="form-set col-md-4">
                            <label class="label">{{'dashboard.parents.relatedType'|translate}}</label>
                            <p-dropdown formControlName="relativeRelationId" [options]="relativeRelation$|async" optionValue="id" optionLabel="arabicName"></p-dropdown>
                        </div>

                </div>
            </ng-container>

        </ng-container>


        <ng-container *ngIf="step==2">
            <ng-container *ngIf="!AttachmentEditMode">
                <div class="float-btn" *ngIf="!AttachmentEditMode" (click)="AttachmentEditMode=true">
                    <img src="assets/images/shared/pen-blue-filled.svg" alt="">
                </div>
                <div class="row mt-5">
                    <ng-container *ngFor="let file of attachmentsList.controls; let i = index">
                        <div class="col-md-4 mt-6" *ngIf="file?.value.name || file?.value.url">
                            <div class=" border-dark px-4 py-3 color-gray-800 radius-15 mb-5">
                                <div class="d-flex align-items-center gap-5">
                                    <img src="assets/images/shared/pdf.svg" alt="">
                                    <span> {{file.value?.name}}</span>
                                </div>
                                <ng-container *ngIf="file.value.comment">
                                    <p class="position-relative paragraph paragraph--sm color-gray-600 bg-orange-50 p-4 radius-15 mt-4">
                                        <span class="d-block color-orange-300 mb-2">ملاحظه :</span>
                                        <span class="comment" *ngIf="file.value.comment">{{file.value?.comment}}</span>
                                    </p>
                                </ng-container>
                                
                            </div>
                        </div>
                    </ng-container>
        
                </div>
            </ng-container>
            
            <ng-container *ngIf="AttachmentEditMode">
                <div class="row g-5">
                    <div class="col-md-4"  *ngFor="let file of attachmentsList.controls; let i=index">
                        <div class="" >
                            <app-file-upload 
                            [files]="[{url: file.value?.url,name:file.value?.name, comment:file.value?.comment}]"  
                            [title]="file.value.titel.ar" [accept]="'.pdf'" 
                            [hasComment]="true" 
                            view="full" 
                            (onFileUpload)="addnewAttachmentTo($event, i)" 
                            ></app-file-upload>
                        </div>
                    </div>
                </div>
            </ng-container>

        </ng-container>

        <ng-container *ngIf="step==3">
            <app-child-requests></app-child-requests>
        </ng-container>

    </div>