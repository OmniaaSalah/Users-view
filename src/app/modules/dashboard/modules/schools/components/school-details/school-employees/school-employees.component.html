<div class="row">
    <div class="row align-items-center">
        <div class=" ">
            <ng-container *ngIf="!schoolManager">
                <div class="row g-5">
                    <div class="col-md-4">
                        <app-skeleton count="2" [style]="{'margin-bottom': '3rem'}"></app-skeleton>
                    </div>
                    <div class="col-md-4">
                        <app-skeleton count="2" [style]="{'margin-bottom': '3rem'}"></app-skeleton>
                    </div>
                    <div class="col-md-4">
                        <app-skeleton count="2" [style]="{'margin-bottom': '3rem'}"></app-skeleton>
                    </div>
                </div>

            </ng-container>

            <div class="" *ngIf="schoolManager">
                <div class="d-flex justify-content-between align-items-baseline">
                    <h3 class=" heading heading--tertiary mb-3 color-primary">{{'dashboard.schools.SchoolManager' |translate}} </h3>
                    <button class="btn btn-outline-primary" (click)="patchManagerForm(schoolManager); isManagerModelOpened=true" *permit="claimsEnum.S_EditMangerInformation" >
                        {{'shared.edit' |translate}}
                    </button>
                </div>

                <div class="d-flex align-items-center mt-4">
                    <div  [class]="lang=='en'? 'me-auto': 'ms-auto'">
                        <h3 class=" heading heading--tertiary mb-2">{{schoolManager?.name |currentLang}} </h3>
                        <span class=" color-primary">{{schoolManager.jobTitle.name|currentLang}} {{schoolManager.schoolName|currentLang}}</span>
                    </div>

                    <div class="d-flex align-items-center color-primary">
                        <img src="assets/images/shared/mail.svg" alt="">
                        <span class="mx-2 text-decoration-underline lh-1" role="button"> {{schoolManager?.email}}</span>
                    </div>

                    <div class="col-md-2">
                        <div class="d-flex align-items-center color-primary justify-content-center">
                            <img src="assets/images/shared/phone.svg" alt="">
                            <span class="me-2 lh-1" role="button" dir="ltr"> {{schoolManager?.phoneNumber}}</span>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>


    <hr class="my-6">


    <h3 class="heading heading--tertiary ">{{'dashboard.schools.schoolEmployeeList'|translate }}</h3>
    <div class="prim-table mt-4" *ngIf="employees.totalAllData || employees.loading">
        <p-table #dt [value]="employees.list" [lazy]="true">
            <!-- Table Caption -->
            <ng-template pTemplate="caption">
                <app-table-caption 
                (onFilter)="this.filtration.Page=1;getEmployees()" 
                (onSearch)="this.filtration.Page=1;filtration.KeyWord = $event; getEmployees()" 
                (onExport)="onExport($event)" 
                (onClear)="clearFilter()">
                    <div class="row gx-5 form-set">
                        <div class="col-md-3">
                            <label class="label" for="status">{{'shared.status'|translate }} </label>
                            <p-dropdown [options]="statusOptions" [showClear]="true" [(ngModel)]="filtration.Status" StopProp optionLabel="name" optionValue="value" placeholder="{{'shared.status'|translate }}"></p-dropdown>
                        </div>
                        <div class="col-md-3">
                            <label class="label">{{'dashboard.schools.employeeRole'|translate }} </label>
                            <p-dropdown [filter]="true" StopProp [showClear]="true" filterBy="{{lang=='ar' ? 'name.ar' : 'name.en'}}" p [options]="jobTitleOptions$|async" [(ngModel)]="filtration.jobtitelid" optionLabel="{{lang=='ar'? 'name.ar' : 'name.en'}}" optionValue="id" placeholder="{{'dashboard.schools.employeeRole' |translate }}">

                            </p-dropdown>
                        </div>
                    </div>
                </app-table-caption>
            </ng-template>

            <ng-template pTemplate="header" let-columns="columns">
                <tr>
                  
                    <th pSortableColumn="code">{{'dashboard.schools.employeeId'|translate }}
                        <p-sortIcon field="code"></p-sortIcon>
                    </th>
                    <th pSortableColumn="name">{{'dashboard.schools.employeeName'|translate }}
                        <p-sortIcon field="name"></p-sortIcon>
                    </th>
                    <th pSortableColumn="category">{{'dashboard.schools.employeeNickname'|translate }}
                        <p-sortIcon field="category"></p-sortIcon>
                    </th>
                    <th pSortableColumn="category">{{'dashboard.schools.jobTitle'|translate }}
                        <p-sortIcon field="category"></p-sortIcon>
                    </th>
                    <th pSortableColumn="quantity">{{'shared.email'|translate }}
                        <p-sortIcon field="quantity"></p-sortIcon>
                    </th>
                    <th pSortableColumn="price">{{'shared.personalId'|translate }}
                        <p-sortIcon field="price"></p-sortIcon>
                    </th>
                    <th pSortableColumn="actions">{{'dashboard.schools.employeeStatus'|translate }}</th>
                    <th class="actions"></th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-employee let-columns="columns">
                <tr>
                 
                    <td>{{employee?.employeeIdNumber}}</td>
                    <td>{{employee?.name |currentLang}}</td>
                    <td>{{employee?.surName |currentLang}}</td>
                    <td>{{employee?.jobTitle | currentLang}}</td>
                    <td>{{employee?.email}}</td>
                    <td>{{employee?.emiratesIdNumber}}</td>
                    <td>
                        <div class="d-flex align-items-center gap-4">
                         
                            <span [ngSwitch]="employee?.status">
                              <div class="alerting success" *ngSwitchCase="statusEnum.Active">{{'shared.allStatus.Active'|translate}}</div>
                              <div class="alerting danger"  *ngSwitchCase="statusEnum.Inactive">{{'shared.allStatus.Inactive'|translate}}</div>
                              <div class="alerting danger" *ngSwitchCase="statusEnum.Deleted">{{'shared.allStatus.deleted'|translate}}</div>
                      </span>
                        </div>
                    </td>

                    <td class="actions">
                        <div role="button" class=" d-flex gap-3 color-skyBlue-500 align-items-center" (click)="patchForm(employee)">
                            {{'shared.edit'|translate}}   <img  [class.rotate180]="lang=='en'" src="assets/images/shared/arrow.svg" alt="">
                        </div>
                   </td>
                </tr>
            </ng-template>

            <ng-template pTemplate="emptymessage" let-columns>
                <tr>
                    <td [attr.colspan]="20">
                        <ng-container *ngIf="employees.totalAllData && employees.list.length == 0 &&  !employees.loading">
                            <app-informative-block title="{{'emptyList.noDataMatch' |translate}}" src="assets/images/empty-list/empty-list.svg"></app-informative-block>
                        </ng-container>

                        <app-loader></app-loader>
                    </td>
                </tr>
            </ng-template>

        </p-table>


        <div class="" *ngIf="employees.total > paginationState.rows">
            <app-pagination [totalItems]="employees.total" (paginationChanged)="paginationChanged($event)"></app-pagination>
        </div>
    </div>

    <ng-container *ngIf="!employees.totalAllData && !employees.loading">
        <app-informative-block subTitle="{{'emptyList.employee' |translate}}" src="assets/images/empty-list/empty-list.svg"></app-informative-block>
    </ng-container>
</div>






<p-dialog header="{{'dashboard.schools.editSchoolManager' | translate}}" [(visible)]="isManagerModelOpened" [modal]="true" [style]="{width: '48vw', height:'80%'}">
    <ng-template pTemplate="content">
        <div class="employee">

            <div class="">
                <form class="custom-form" [formGroup]="managerForm">
                    <div class="row gx-5 form-set">
                        <div class="col-md-6">
                            <label class="label" for="password">{{'shared.password' | translate}}</label>
                            <p-password 
                            #inputPass 
                            (onFocus)="managerFormCtr.password.markAsTouched()" 
                            (onBlur)="managerFormCtr.password.markAsUntouched()"
                            iconPos="left" 
                            formControlName="password" 
                            [feedback]="false" [toggleMask]="true" name="password" placeholder="**************" ></p-password>

                            <div class="hint-group" *ngIf="managerFormCtr.password.touched && !managerFormCtr.password.dirty">
                                <div class="hint">
                                    <img src="assets/images/shared/hint.svg" alt="">
                                    <p>يجب ان تحتوى على الاقل على حرف صغير وكبير</p>
                                </div>
                                <div class="hint">
                                    <img src="assets/images/shared/hint.svg" alt="">
                                    <p>يجب ان تحتوى على الاقل على عدد 8 أحرف</p>
                                </div>
                                <div class="hint">
                                    <img src="assets/images/shared/hint.svg" alt="">
                                    <p>يجب ان تحتوى على الاقل على عدد</p>
                                </div>
                                <div class="hint">
                                    <img src="assets/images/shared/hint.svg" alt="">
                                    <p>يجب ان تحتوى على الاقل على رمز</p>
                                </div>
                            </div>
                            <div class="errors" *ngIf="managerFormCtr.password.errors">
                                <p class="color-red-500" *ngIf="managerFormCtr.password.errors?.pattern && !managerFormCtr.password.errors?.required && managerFormCtr.password.touched">يجب ان تحتوى على الاقل على حرف صغير وكبير</p>
                                <p class="color-red-500" *ngIf="managerFormCtr.password.errors?.pattern && !managerFormCtr.password.errors?.required && managerFormCtr.password.touched">يجب ان تحتوى على الاقل على 8 أحرف</p>
                                <p class="color-red-500" *ngIf="managerFormCtr.password.errors?.pattern && !managerFormCtr.password.errors?.required && managerFormCtr.password.touched">يجب ان تحتوى على الاقل على عدد</p>
                                <p class="color-red-500" *ngIf="managerFormCtr.password.errors?.pattern && !managerFormCtr.password.errors?.required && managerFormCtr.password.touched">يجب ان تحتوى على الاقل على رمز</p>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <!-- [ngClass]="{'ng-invalid ng-dirty': f.confirmPassword.errors && f.confirmPassword.errors?.['missMatching']}"  -->
                            <label class="label" for="confirmPassword">{{'shared.confirmPassword' | translate}}</label>
                            <p-password [feedback]="false" formControlName="confirmPassword" [toggleMask]="true" name="confirmPassword" placeholder="**************"></p-password>

                            <div class="errors" *ngIf="managerFormCtr.confirmPassword.errors">
                                <div class="color-red-500" *ngIf="managerFormCtr.confirmPassword.errors?.['missMatching']">الرقم السر لا يطابق</div>
                            </div>
                        </div>
                    </div>

                    <div class="row gx-5 form-set">
                        <div class="col-md-6">
                            <label class="label" for="jobTitle">{{'dashboard.schools.newManager' | translate}}</label>
                            <!-- <input pInputText formControlName="jobTitle"> -->
                            <p-dropdown formControlName="newManagerId"
                            [filter]="true"
                            filterBy="{{lang=='ar'? 'name.ar' : 'name.en'}}"
                            (onFilter)="searchModel.KeyWord =$event"
                            [ngClass]="{'ng-invalid ng-dirty': managerFormCtr.jobTitleId.errors && managerFormCtr.jobTitleId.errors?.['required']}"
                             [options]="employees$ |async" optionLabel="{{lang=='ar'? 'name.ar' : 'name.en'}}"  optionValue="id" placeholder="{{'dashboard.schools.newManager' | translate}}">
                            </p-dropdown>
                        </div>

                        <div class="col-md-4 align-self-end mb-3">
                            <!-- <label class="label" for="status">{{'dashboard.schools.employeeStatus' | translate}} </label> -->
                            <div class="d-flex align-items-center gap-4">
                                <div class="fs-4">تفعيل</div>
                                <span class="fs-4" *ngIf="managerFormCtr.status.value === statusEnum.Active">{{'shared.yes' |translate}}</span>
                                <span class="fs-4" *ngIf="managerFormCtr.status.value === statusEnum.Inactive">{{'shared.no' |translate}}</span>
                                <p-inputSwitch name="status" #status formControlName="status" [trueValue]="statusEnum.Inactive" [falseValue]="statusEnum.Active"></p-inputSwitch>
                            </div>
                        </div>
                    </div>
                    <div class="py-6"></div>
                    <div class="d-flex  align-items-center justify-content-end mt-6">
                        <button class="btn btn-primary btn--md" [disabled]="managerForm.invalid || isSubmited" (click)="updateManager(managerForm.value);$event.preventDefault()">
                            <span>{{'shared.saveChanges'| translate}} </span>
                            <div class="spinner-border text-light" role="status" *ngIf="isSubmited"></div>

                        </button>
                    </div>
                </form>
            </div>
        </div>
    </ng-template>
</p-dialog>



<p-dialog header="{{'dashboard.schools.editSchoolEmployeeInfo' | translate}}" [(visible)]="isEmployeeModelOpened" [modal]="true" [style]="{width: '54vw',height:'85vh'}">
    <ng-template pTemplate="content">
        <div class="employee">

            <div class="">
                <form class="custom-form" [formGroup]="employeeForm">
                    <div class="row gx-5 form-set">
                        <div class="col-md-6">
                            <label class="label" for="password">{{'shared.password' | translate}}</label>
                            <p-password #inputPass (onFocus)="employeeFormCtr.password.markAsTouched()" iconPos="left" formControlName="password" [feedback]="false" [toggleMask]="true" name="password" placeholder="**************"></p-password>

                            <div class="hint-group" *ngIf="employeeFormCtr.password.touched && !employeeFormCtr.password.dirty">
                                <div class="hint">
                                    <img src="assets/images/shared/hint.svg" alt="">
                                    <p>يجب ان تحتوى على الاقل على حرف صغير و كبير</p>
                                </div>
                                <div class="hint">
                                    <img src="assets/images/shared/hint.svg" alt="">
                                    <p>يجب ان تحتوى على الاقل على 8 احرف</p>
                                </div>
                                <div class="hint">
                                    <img src="assets/images/shared/hint.svg" alt="">
                                    <p>يجب ان تحتوى على الاقل على عدد</p>
                                </div>
                                <div class="hint">
                                    <img src="assets/images/shared/hint.svg" alt="">
                                    <p>يجب ان تحتوى على الاقل على رمز</p>
                                </div>
                            </div>
                            <div class="errors" *ngIf="employeeFormCtr.password.errors">
                                <p class="color-red-500" *ngIf="employeeFormCtr.password.errors?.pattern && !employeeFormCtr.password.errors?.required && employeeFormCtr.password.touched">يجب ان تحتوى على الاقل على 8 أحرف</p>
                                <p class="color-red-500" *ngIf="employeeFormCtr.password.errors?.pattern && !employeeFormCtr.password.errors?.required && employeeFormCtr.password.touched">يجب ان تحتوى على الاقل على حرف صغير وكبير</p>
                                <p class="color-red-500" *ngIf="employeeFormCtr.password.errors?.pattern && !employeeFormCtr.password.errors?.required && employeeFormCtr.password.touched">يجب ان تحتوى على الاقل على عدد</p>
                                <p class="color-red-500" *ngIf="employeeFormCtr.password.errors?.pattern && !employeeFormCtr.password.errors?.required && employeeFormCtr.password.touched">يجب ان تحتوى على الاقل على رمز</p>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <!-- [ngClass]="{'ng-invalid ng-dirty': f.confirmPassword.errors && f.confirmPassword.errors?.['missMatching']}"  -->
                            <label class="label" for="confirmPassword">{{'shared.confirmPassword' | translate}}</label>
                            <p-password [feedback]="false" formControlName="confirmPassword" [toggleMask]="true" name="confirmPassword" placeholder="**************"></p-password>

                            <div class="errors" *ngIf="employeeFormCtr.confirmPassword.errors">
                                <div class="color-red-500" *ngIf="employeeFormCtr.confirmPassword.errors?.['missMatching']">الرقم السر لا يطابق</div>
                            </div>
                        </div>
                    </div>

                    <div class="row gx-5 form-set">
                        <div class="col-md-6">
                            <label class="label" for="jobTitle">{{'dashboard.schools.employeeRole' | translate}}</label>
                            <!-- <input pInputText formControlName="jobTitle"> -->
                            <p-dropdown 
                            formControlName="jobTitleId" 
                            [ngClass]="{'ng-invalid ng-dirty': employeeFormCtr.jobTitleId.errors && employeeFormCtr.jobTitleId.errors?.['required']}" 
                            [options]="jobTitleOptions$ |async" optionLabel="{{lang=='ar'? 'name.ar' : 'name.en'}}"
                            optionValue="id" placeholder="{{'dashboard.schools.employeeRole' | translate}}"></p-dropdown>


                        </div>

                        <div class="col-md-4 align-self-end mb-3">
                            <!-- <label class="label" for="status">{{'dashboard.schools.employeeStatus' | translate}} </label> -->
                            <div class="d-flex align-items-center gap-4">
                                <div class="fs-4">تفعيل</div>
                                <span class="fs-4" *ngIf="employeeFormCtr.status.value === statusEnum.Active">{{'shared.yes' |translate}}</span>
                                <span class="fs-4" *ngIf="employeeFormCtr.status.value === statusEnum.Inactive">{{'shared.no' |translate}}</span>
                                <p-inputSwitch name="status" #status formControlName="status" [trueValue]="statusEnum.Active" [falseValue]="statusEnum.Inactive"></p-inputSwitch>
                            </div>
                        </div>
                    </div>
                    <!-- <div class="py-6"></div> -->
                  
                </form>
            </div>
        </div>
    </ng-template>
    <ng-template pTemplate="footer">
        <div class="d-flex  align-items-center justify-content-end">
            <button class="btn btn-primary btn--md" [disabled]="employeeForm.invalid" (click)="updateEmployee(employeeForm.value)" >
              <span>{{'shared.saveChanges'| translate}} </span>
              <div class="spinner-border text-light" role="status" *ngIf="isSubmited || isSubmited"></div>

          </button>
        </div>
      </ng-template>
</p-dialog>
