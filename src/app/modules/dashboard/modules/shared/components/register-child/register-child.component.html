
<ng-container *ngIf="isLoading">
    <div class="row mb-4">
        <div class="col-4 d-flex gap-4 align-items-center">
            <app-skeleton size="7rem"></app-skeleton>
            <app-skeleton width="20rem"  count="2" height="2rem"></app-skeleton>
        </div>
    </div>
    <div class="row g-5 mb-4">
        <ng-container *ngFor="let i of [1,2,3]">
            <div class="col-md-3">
                <app-skeleton> </app-skeleton>
            </div>
        </ng-container>
        
    </div>
    <div class="row g-5 mb-3">
        <ng-container *ngFor="let i of [1,2]">
            <div class="col-md-3">
                <app-skeleton height="1rem"> </app-skeleton>
                <app-skeleton height="1rem"> </app-skeleton>
                <app-skeleton height="1rem"> </app-skeleton>
            </div>
        </ng-container>
        
    </div>
    <div class="row g-5 mb-3">
        <ng-container *ngFor="let i of [1,2,3,4,5,6]">
            <div class="col-md-2">
                <app-skeleton> </app-skeleton>
            </div>
        </ng-container>
        
    </div>
</ng-container>



<div class="radius-15 border p-5 mb-5 bg-white" *ngIf="!isLoading">
    <div class="d-flex align-items-center justify-content-between bg-white">
        <div class="profile d-flex align-items-center">
            <div class="profile__avatar">
                <img [src]="student.src" alt="Avatar">
            </div>
            <div class="profile__info">
                <div class="profile__name ">
                    <h4 class="heading heading--tertiary">{{student.name}}</h4>
                    <div class="" *ngIf="student.regestered">
                        <img src="assets/images/shared/medal.svg" alt="">
                        <span class="color-red-500">الموهبه</span>
                    </div>
                    <div >
                        <img src="assets/images/shared/medal-cup.svg" alt="">
                        <span class="color-yellow-400">من الاوائل</span>
                    </div>
                    <div >
                        <img src="assets/images/shared/medal-flag.svg" alt="">
                        <span class="color-fuchsia-500">ابناء الشهداء</span>
                    </div>
                </div>
                <div class="profile__details">
                    <div class="fs-4">
                        <img src="assets/images/shared/child.svg" alt="">
                        <span class="color-gray-300">12 سنه</span>
                    </div>
                    <div>
                        <img *ngIf="student.regestered" src="assets/images/shared/fingure.svg" alt="">
                        <span class="color-gray-300 fs-4">
                        مسجل
                      </span>
                    </div>
                    <div *ngIf="student.regestered">
                        <img src="assets/images/shared/branch.svg" alt="">
                        <span class="color-gray-300 fs-4">الصف الرابع</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="actions d-flex align-items-center gap-3 mb-5">
            <ng-container *ngIf="student.regestered">

                <ng-container *ngIf="onEditMode ">
                    <button class="btn btn-primary btn--sm px-5" [disabled]="(childService.submitBtnClicked$ | async)" (click)="childService.submitBtnClicked$.next(true)">
                        <span>{{'shared.saveChanges'| translate}}</span>
                        <div class="spinner-border text-light" role="status" *ngIf="(childService.submitBtnClicked$ | async)"></div>
                  </button>
                </ng-container>
                <!-- <ng-container *ngIf="(step==1 && onEditMode) || (step==7  && onEditMode) ">
                    <button class="btn btn-primary btn--sm px-5" (click)="childService.submitBtnClicked$.next(true)">
                      <span>{{'shared.saveChanges'| translate}}</span>
                  </button>
                </ng-container> -->

                <ng-container *ngIf="!onEditMode">
                    <button class="btn btn-primary btn--sm px-5" (click)="transferStudentModelOpened=true">
                      <span>{{'dashboard.schools.transferStudentToAnotherDivision'|translate}}</span>
                  </button>
                  <app-dropdown [items]="items"></app-dropdown>
                    <!-- <button class="btn btn-outline-primary btn--sm px-5">
                      <span>ارسال طلب اعاده مرحله دراسيه </span>
                  </button> -->
                </ng-container>
                <!-- <ng-container *ngIf="(step == 1 && !onEditMode) || (step == 7 && !onEditMode); then ">
                    <button class="btn btn-primary btn--sm px-5" [routerLink]="['/']">
                      <span>نقل الطالب</span>
                  </button>
                    <button class="btn btn-outline-primary btn--sm px-5">
                      <span>ارسال طلب اعاده مرحله دراسيه </span>
                  </button>
                </ng-container> -->
            </ng-container>
        </div>
    </div>

    <div class="row gx-5 p-4 bg-gray-30 my-5" *ngIf="student.regestered">
        <div class="col-md-3  d-flex align-items-center  gap-4">
            <span class="color-gray-300">الرقم الموحد للطالب</span>
            <span class="color-primary">204204205</span>
        </div>
        <div class="col-md-3 d-flex align-items-center  gap-4">
            <span class="color-gray-300">الرقم الوزاري</span>
            <span class="color-primary">204204205</span>
        </div>
        <div class="col-md-3 d-flex align-items-center  gap-4">
            <span class="color-gray-300">رقم المنهل</span>
            <span class="color-primary">204204205</span>
        </div>
    </div>

    <div class="row" *ngIf="student.regestered">
        <div class="col-6">
            <div class="d-flex align-items-center gap-4">
                <span>محظور من طلب اصدار الشهادة: </span><span class="color-skyBlue-500">نعم</span>
            </div>
        </div>
        <div class="col-6">
            <div class="d-flex align-items-center gap-4">
                <span>محظور من الانسحاب: </span><span class="color-skyBlue-500">نعم</span>
            </div>
        </div>
    </div>
</div>




<div class="tabView " [class.show-controls]="navListLength > 7">
    <!-- nav Controls -->
    <div class="arrow-left" (click)="scrollLeft(nav)">
        <img src="assets/images/shared/chevron-left.svg" alt="">
    </div>
    <div class="arrow-right" (click)="scrollRight(nav)" [class.d-none]="hideNavControl">
        <img src="assets/images/shared/chevron-right.svg" alt="">
    </div>
    <!-- Navigations Options -->
    <ul class="tabView__nav" [class.pe-0]="hideNavControl" #nav>
        <li class="tabView__nav__link" data-step="1" *permit="permissionEnum.S_EMPLOYEE" [class.active]="step==1" (click)="step=1"><span>{{ 'dashboard.parents.personalInfo'|translate }}</span></li>
        <li class="tabView__nav__link" data-step="2" *permit="permissionEnum.S_EMPLOYEE" [class.active]="step==2" (click)="step=2"><span>{{ 'dashboard.parents.acceptanceInfo'|translate }}</span></li>
        <li class="tabView__nav__link" data-step="3" *permit="permissionEnum.S_EMPLOYEE" [class.active]="step==3" (click)="step=3"><span> {{ 'dashboard.parents.attendanceAndAbsence'|translate }}</span></li>
        <li class="tabView__nav__link" data-step="4" *permit="permissionEnum.S_EMPLOYEE" [class.active]="step==4" (click)="step=4"><span>{{ 'dashboard.students.studentAttachedment'|translate }}</span></li>
        <li class="tabView__nav__link" data-step="5" *permit="permissionEnum.S_EMPLOYEE" [class.active]="step==5" (click)="step=5"><span> {{ 'dashboard.parents.certificateList'|translate }}</span></li>
        <li class="tabView__nav__link" data-step="6" *permit="permissionEnum.S_EMPLOYEE" [class.active]="step==6" (click)="step=6"><span>{{ 'dashboard.parents.studentBehavior'|translate }}</span></li>
        <li class="tabView__nav__link" data-step="7" *permit="[permissionEnum.S_EMPLOYEE, permissionEnum.NURSE]" [class.active]="step==7" (click)="step=7"><span>{{ 'dashboard.students.medicalFile'|translate }}</span></li>
        <li class="tabView__nav__link" data-step="8" *permit="permissionEnum.S_EMPLOYEE" [class.active]="step==8" (click)="step=8"><span>{{ 'dashboard.parents.editableList'|translate }}</span></li>
        <li class="tabView__nav__link" data-step="9" *permit="permissionEnum.S_EMPLOYEE" [class.active]="step==9" (click)="step=9"><span>{{ 'dashboard.parents.studentRecord'|translate }}</span></li>
    </ul>
    <!-- Table Caption -->

    <div class="tabView__content">
        <form class="custom-form">

            <ng-container *ngIf="step==1">
                <app-personal-information></app-personal-information>
            </ng-container>


            <ng-container *ngIf="step==2">
                <app-accept-information></app-accept-information>
            </ng-container>


            <ng-container *ngIf="step==3">

                <app-absence-details></app-absence-details>
            </ng-container>


            <ng-container *ngIf="step==4">
                <app-attachments-child></app-attachments-child>
            </ng-container>


            <ng-container *ngIf="step==5">
                <div class="child__info__section absence">
                    <div class="schools">
                        <!-- Table Caption -->
                        <ng-template pTemplate="caption">
                            <app-table-caption [filterFormControls]="['status','city','state','course']"></app-table-caption>

                        </ng-template>
                        <div class="prim-table mt-4">
                            <p-table #dt [value]="schoolClasses" [paginator]="true" [(rows)]="rows" [(first)]="first">
                                <!-- Table Caption -->
                                <ng-template pTemplate="caption">
                                    <app-table-caption [filterFormControls]="['status','city','state','course']"></app-table-caption>

                                </ng-template>

                                <ng-template pTemplate="header" let-columns="columns">
                                    <tr>
                                        <!-- <th *ngFor="let col of cols">
                                    {{col.header}}
                                </th>
                                <th pSortableColumn="actions"></th> -->
                                        <th pSortableColumn="code">{{'dashboard.schools.Typeofcertificate'|translate}}
                                            <p-sortIcon field="code"></p-sortIcon>
                                        </th>
                                        <th pSortableColumn="name">{{'dashboard.schools.SchoolYear'|translate}}
                                            <p-sortIcon field="name"></p-sortIcon>
                                        </th>
                                        <th pSortableColumn="price">{{'dashboard.schools.Dateofapplicationforthecertificate'|translate}}
                                            <p-sortIcon field="price"></p-sortIcon>
                                        </th>


                                        <th pSortableColumn="actions"></th>
                                    </tr>
                                </ng-template>

                                <ng-template pTemplate="body" let-product>

                                    <!-- <ng-container *ngIf="false then thenBlock else emptyList"></ng-container> -->

                                    <tr routerLink="school/4">
                                        <td>{{product.code}}</td>
                                        <td>{{product.name}}</td>
                                        <td>{{product.quantity}}</td>

                                        <td>
                                            <a class="color-skyBlue-500 text-decoration-underline">الإطلاع
                                            <!-- <fa-icon class="icon" [icon]="faCheck"></fa-icon> -->
                                            <img src="../../../../../../../assets/images/shared/eye.svg" alt="">
                                        </a>
                                        </td>
                                    </tr>
                                </ng-template>

                                <!-- <ng-template pTemplate="footer" let-columns="columns">
                            <tr  class="p-rowgroup-footer">
                                <td [attr.colspan]="7" style="width: 100%">
                                    <div *ngIf="schoolClasses.length > 0">
                                        <app-pagination [totalItems]="schoolClasses.length" (paginationChanged)="paginationChanged($event)"></app-pagination>
                                    </div>
                                </td>
                            </tr>
                        </ng-template> -->

                                <ng-template pTemplate="emptymessage" let-columns>
                                    <tr>
                                        <td [attr.colspan]="20">
                                            <app-informative-block title="{{'emptyList.schools' |translate}}" src="assets/images/empty-list/empty-list.svg"></app-informative-block>
                                        </td>
                                    </tr>
                                </ng-template>

                            </p-table>
                            <div class="">
                                <app-pagination [totalItems]="schoolClasses.length" (paginationChanged)="paginationChanged($event)"></app-pagination>
                            </div>

                        </div>
                    </div>
                </div>
            </ng-container>


            <!-- Medical Fils -->
            <ng-container *ngIf="step==7">

                <app-medical-file></app-medical-file>

            </ng-container>
            <!-------Student record---------->
            <ng-container *ngIf="step==9">
                <div class="prim-table mt-4">

                    <p-table #dt [value]="schoolClasses" [paginator]="true" [(rows)]="rows" [(first)]="first">


                        <!-- Table Caption -->
                        <ng-template pTemplate="caption">
                            <app-table-caption [filterFormControls]="['status','city','state','course']"></app-table-caption>

                        </ng-template>
                        <ng-template pTemplate="caption">
                            <app-table-caption [filterFormControls]="['status','city','state','course']"></app-table-caption>

                        </ng-template>
                        <ng-template pTemplate="header" let-columns="columns">
                            <tr>
                                <th pSortableColumn="code">
                                    <div class="content">
                                        {{'dashboard.parents.subjectName'|translate }}
                                        <p-sortIcon field="code"></p-sortIcon>
                                    </div>
                                </th>
                                <th pSortableColumn="name">
                                    {{'dashboard.parents.Mandatory/Optional'|translate }}
                                    <p-sortIcon field="name"></p-sortIcon>
                                </th>
                                <th pSortableColumn="category">{{'dashboard.parents.Evaluation'|translate }}
                                    <p-sortIcon field="category"></p-sortIcon>
                                </th>
                                <th pSortableColumn="quantity">{{'dashboard.parents.Result'|translate }}
                                    <p-sortIcon field="quantity"></p-sortIcon>
                                </th>
                                <th pSortableColumn="price">{{'dashboard.parents.studentperformance'|translate }}
                                    <p-sortIcon field="price"></p-sortIcon>
                                </th>
                                <th pSortableColumn="actions">{{'dashboard.parents.GPA'|translate }}
                                    <p-sortIcon field="price"></p-sortIcon>
                                </th>
                                <th pSortableColumn="actions">{{'dashboard.parents.Credithour'|translate }}
                                    <p-sortIcon field="price"></p-sortIcon>
                                </th>

                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-product let-columns="columns">
                            <tr>

                                <td>{{product.code}}</td>
                                <td>{{product.name}}</td>
                                <td>{{product.category}}</td>
                                <td>{{product.quantity}}</td>
                                <td>
                                    <div class="color-skyBlue-500 ">
                                        <a role="button" class="color-skyBlue-500  text-decoration-underline fs-4" (click)="openResponsesModal()">
                                            <p>6</p>
                                        </a>
                                    </div>
                                </td>
                                <td>
                                    <!-- <div class="alerting success">جديد</div>
                                <div class="alerting warning">مرسل</div> -->

                                    <div class="alerting danger">مغلق</div>

                                </td>
                                <td class="edit">
                                    <button routerLink="/dashboard/educational-settings/surveys/survey-details">
                                {{'shared.details'|translate}}   <img  src="assets/images/shared/arrow.svg" alt="">
                             </button>
                                </td>

                            </tr>
                        </ng-template>

                    </p-table>

                    <div class="">
                        <app-pagination [totalItems]="schoolClasses.length" (paginationChanged)="paginationChanged($event)"></app-pagination>
                    </div>
                </div>
            </ng-container>
        </form>

    </div>
</div>


<!-- transfer Student to another division Dialog -->
<p-dialog header="{{'dashboard.schools.transferStudentToAnotherDivision'|translate}}" [(visible)]="transferStudentModelOpened" [modal]="true" [style]="{width: '40vw'}">
    <ng-template pTemplate="content">
        <div class="custom-form" ngForm #f="ngForm">
            <div class="row form-set">
                <div class="col-md-12">
                    <label class="label" >{{'dashboard.schools.currentDivision'|translate}} </label>
                    <p-dropdown name="current" 
                    [options]="currentDivision" 
                    [(ngModel)]="transferStudentForm.currentDivisionId" 
                    optionValue="id" optionLabel="name.ar" 
                    placeholder="{{'shared.currentDivition'|translate}}" required=""></p-dropdown>
                </div>
            </div>

            <div class="row form-set">
                <div class="col-md-12">
                    <label class="label">{{'dashboard.schools.divisionToTransferTo'|translate}} </label>
                    <p-dropdown 
                    [ngClass]="{'ng-invalid ng-dirty': transferNotAllawed}" 
                    name="taget"
                    [options]="gradeDivisions$ | async" 
                    ngModel
                    #target="ngModel"
                    (ngModelChange)="onTargetDivisionSelected($event)"
                     optionLabel="name.ar" 
                     placeholder="{{'shared.chooseDivition'|translate}}"></p-dropdown>
                     <div *ngIf="transferNotAllawed" class="mt-2 color-red-500 fs-4">لا يمكن تجاوز العدد الاعظمي للطلاب في الشعبة.</div>
                </div>
            </div>

            
            <div class="row form-set" *ngIf="showTracks">
                <div class="col-md-12">
                    <label class="label">{{'shared.track'|translate}} </label>
                    <p-dropdown name="track" [options]="divisionTracks$ | async" 
                    [(ngModel)]="transferStudentForm.trackId" 
                    optionValue="id" optionLabel="name.ar" 
                    placeholder="{{'shared.chooseTrack'|translate}}" 
                    [required]="target.value"></p-dropdown>
                </div>
            </div>

            <div class="row gx-5 gy-4 form-set">
                <label class="label fw-bold" for="">{{'shared.optionalSubjects'|translate}}</label>
                
                <ng-container *ngFor="let subject of (optionalSubjects$|async)">
                    <div class="col-md-6 d-flex align-items-center gap-4">
                        <p-checkbox  name="subjects" [value]="subject.id" [(ngModel)]="transferStudentForm.electiveSubjectId" required></p-checkbox>
                        <label class="label label--sm" for="">{{subject.name.ar}}</label>
                    </div>
                </ng-container>
            </div>
            <div class="d-flex  align-items-center justify-content-end mt-5">
                <button class="btn btn-primary btn--sm" (click)="transferStudent()" [disabled]="onSubmit || transferNotAllawed || !f.valid">
                    <!-- <fa-icon class="icon" [icon]="faCheck"></fa-icon> -->
                    <span>{{'shared.save'| translate}} </span>
                    <div class="spinner-border text-light" role="status" *ngIf="onSubmit"></div>
                </button>
            </div>
        </div>
    </ng-template>
</p-dialog>